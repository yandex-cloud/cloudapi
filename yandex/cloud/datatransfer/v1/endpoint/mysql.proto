syntax = "proto3";

package yandex.cloud.datatransfer.v1.endpoint;

option go_package = "github.com/yandex-cloud/go-genproto/yandex/cloud/datatransfer/v1/endpoint;endpoint";
option java_package = "yandex.cloud.api.datatransfer.v1.endpoint";
option csharp_namespace = "Yandex.Cloud.Datatransfer.V1.EndPoint"; // there is a clash with class Endpoint in namespace Yandex.Cloud.Datatransfer.V1

import "yandex/cloud/datatransfer/v1/endpoint/common.proto";

message OnPremiseMysql {
    reserved 1, 3;
    // Port for the database connection
    int64 port = 2;
    // Identifier of the Yandex Cloud VPC subnetwork to user for accessing the
    // database.
    // If omitted, the server has to be accessible via Internet
    string subnet_id = 4;
    // List of host names of the MySQL server. Exactly one host is expected
    repeated string hosts = 5;
    // TLS settings for server connection. Disabled by default.
    TLSMode tls_mode = 6;
}
message MysqlConnection {
    oneof connection {
        // Managed Service for MySQL cluster ID
        string mdb_cluster_id = 1;
        // Connection options for on-premise MySQL
        OnPremiseMysql on_premise = 2;
        // Get Mysql installation params and credentials from Connection Manager
        ConnectionManagerConnection connection_manager_connection = 3;
    }
}
message MysqlObjectTransferSettings {
    // Views
    // 
    // CREATE VIEW ...
    ObjectTransferStage view = 1;
    // Routines
    // 
    // CREATE PROCEDURE ... ; CREATE FUNCTION ... ;
    ObjectTransferStage routine = 2;
    // Triggers
    // 
    // CREATE TRIGGER ...
    ObjectTransferStage trigger = 3;
    ObjectTransferStage tables = 4;
}
// Settings specific to the MySQL source endpoint
message MysqlSource {
    reserved 5 to 7, 9 to 10;
    // Database connection settings
    MysqlConnection connection = 1;
    // Name of the database to transfer
    // 
    // You can leave it empty, then it will be possible to transfer tables from several
    // databases at the same time from this source.
    string database = 2;
    // User for database access. Required unless connection manager connection is used
    string user = 3;
    // Password for database access.
    Secret password = 4;
    // Database timezone
    // 
    // Is used for parsing timestamps for saving source timezones. Accepts values from
    // IANA timezone database. Default: local timezone.
    string timezone = 8;
    // Schema migration
    // Defines which database schema objects should be transferred, e.g. views,
    // routines, etc. 
    // All of the attrubutes in the block are optional and should be either
    // `BEFORE_DATA`, `AFTER_DATA` or `NEVER`."
    MysqlObjectTransferSettings object_transfer_settings = 11;
    // List of regular expressions of table names which should be transferred. A table
    // name is formatted as schemaname.tablename. For example, a single regular
    // expression may look like `^mydb.employees$`
    repeated string include_tables_regex = 12;
    // Opposite of `include_table_regex`. The tables matching the specified regular
    // expressions will not be transferred
    repeated string exclude_tables_regex = 13;
    // List of security groups that the transfer associated with this endpoint should
    // use
    repeated string security_groups = 14;
    // Database for service tables
    // Default: data source database. Here created technical tables (__tm_keeper,
    // __tm_gtid_keeper).
    string service_database = 15;
}
// Settings specific to the MySQL target endpoint
message MysqlTarget {
    reserved 9 to 14;
    // Database connection settings
    MysqlConnection connection = 1;
    // Database name
    // 
    // Allowed to leave it empty, then the tables will be created in databases with the
    // same names as on the source. If this field is empty, then you must fill below db
    // schema for service table.
    string database = 2;
    // User for database access. Required unless connection manager connection is used
    string user = 3;
    // Password for database access.
    Secret password = 4;
    // [sql_mode](https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html) to use when
    // interacting with the server. 
    // Defaults to `NO_AUTO_VALUE_ON_ZERO,NO_DIR_IN_CREATE,NO_ENGINE_SUBSTITUTION`
    string sql_mode = 5;
    // Disable constraints checks
    // When `true`, disables foreign key checks and unique checks. `False` by default.
    // See
    // [foreign_key_checks](https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_foreign_key_checks).
    // Recommend to disable for increase replication speed unless schema contains
    // cascading operations 
    bool skip_constraint_checks = 6;
    // Database timezone
    // 
    // Is used for parsing timestamps for saving source timezones. Accepts values from
    // IANA timezone database. Default: local timezone.
    string timezone = 7;
    // Cleanup policy for activate, reactivate and reupload processes.  
    // One of `DISABLED`, `DROP` or `TRUNCATE` Default is `DISABLED`.
    CleanupPolicy cleanup_policy = 8;
    // Database schema for service table
    // Default: db name. Here created technical tables (__tm_keeper, __tm_gtid_keeper).
    string service_database = 15;
    // List of security groups that the transfer associated with this endpoint should
    // use
    repeated string security_groups = 16;
    // Whether can change table schema if schema changed on source
    bool is_schema_migration_disabled = 17;
}
