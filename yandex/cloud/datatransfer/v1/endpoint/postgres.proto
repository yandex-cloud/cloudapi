syntax = "proto3";

package yandex.cloud.datatransfer.v1.endpoint;

option go_package = "github.com/yandex-cloud/go-genproto/yandex/cloud/datatransfer/v1/endpoint;endpoint";
option java_package = "yandex.cloud.api.datatransfer.v1.endpoint";
option csharp_namespace = "Yandex.Cloud.Datatransfer.V1.EndPoint"; // there is a clash with class Endpoint in namespace Yandex.Cloud.Datatransfer.V1

import "yandex/cloud/datatransfer/v1/endpoint/common.proto";

message PostgresObjectTransferSettings {
    // Sequences
    // 
    // CREATE SEQUENCE ...
    ObjectTransferStage sequence = 1;
    // Owned sequences
    // 
    // CREATE SEQUENCE ... OWNED BY ...
    ObjectTransferStage sequence_owned_by = 2;
    // Tables
    // 
    // CREATE TABLE ...
    ObjectTransferStage table = 3;
    // Primary keys
    // 
    // ALTER TABLE ... ADD PRIMARY KEY ...
    ObjectTransferStage primary_key = 4;
    // Foreign keys
    // 
    // ALTER TABLE ... ADD FOREIGN KEY ...
    ObjectTransferStage fk_constraint = 5;
    // Default values
    // 
    // ALTER TABLE ... ALTER COLUMN ... SET DEFAULT ...
    ObjectTransferStage default_values = 6;
    // Constraints
    // 
    // ALTER TABLE ... ADD CONSTRAINT ...
    ObjectTransferStage constraint = 7;
    // Indexes
    // 
    // CREATE INDEX ...
    ObjectTransferStage index = 8;
    // Views
    // 
    // CREATE VIEW ...
    ObjectTransferStage view = 9;
    // Functions
    // 
    // CREATE FUNCTION ...
    ObjectTransferStage function = 10;
    // Triggers
    // 
    // CREATE TRIGGER ...
    ObjectTransferStage trigger = 11;
    // Types
    // 
    // CREATE TYPE ...
    ObjectTransferStage type = 12;
    // Rules
    // 
    // CREATE RULE ...
    ObjectTransferStage rule = 13;
    // Collations
    // 
    // CREATE COLLATION ...
    ObjectTransferStage collation = 14;
    // Policies
    // 
    // CREATE POLICY ...
    ObjectTransferStage policy = 15;
    // Casts
    // 
    // CREATE CAST ...
    ObjectTransferStage cast = 16;
    // Materialized views
    // 
    // CREATE MATERIALIZED VIEW ...
    ObjectTransferStage materialized_view = 17;
    // 
    ObjectTransferStage sequence_set = 18;
}
message OnPremisePostgres {
    reserved 1, 3;
    // PG port. Will be used if the cluster ID is not specified.
    int64 port = 2;
    // Identifier of the Yandex Cloud VPC subnetwork to user for accessing the
    // database. 
    // If omitted, the server has to be accessible via Internet
    string subnet_id = 4;
    // PG installation hosts
    repeated string hosts = 5;
    // TLS settings for server connection. Disabled by default.
    TLSMode tls_mode = 6;
}
message PostgresConnection {
    oneof connection {
        // Managed Service for PostgreSQL cluster ID
        string mdb_cluster_id = 1;
        // Connection options for on-premise PostgreSQL
        OnPremisePostgres on_premise = 2;
        // Get Postgres installation params and credentials from Connection Manager
        ConnectionManagerConnection connection_manager_connection = 3;
    }
}
// Settings specific to the PostgreSQL source endpoint.
message PostgresSource {
    reserved 7, 10 to 12;
    // Database connection settings
    PostgresConnection connection = 1;
    // Name of the database to transfer
    string database = 2;
    // User for database access. Required unless Connection Manager connection is used.
    string user = 3;
    // Password for database access.
    Secret password = 4;
    // List of tables to transfer, formatted as `schemaname.tablename`. 
    // If omitted or an empty list is specified, all tables will be transferred.
    // Can contain schema_name.* patterns.
    repeated string include_tables = 5;
    // List of tables which will not be transfered, formatted as `schemaname.tablename`
    // If omitted or empty list is specified, all tables are replicated. 
    // Can contain schema_name.* patterns.
    repeated string exclude_tables = 6;
    // Maximum WAL size held by the replication slot (API - in bytes, terraform - in
    // gigabytes); 
    // Exceeding this limit will result in a replication failure and deletion of the
    // replication slot.
    // Default is 50 gigabytes
    int64 slot_byte_lag_limit = 8;
    // Name of the database schema in which auxiliary tables needed for the transfer
    // will be created (__consumer_keeper, __data_transfer_mole_finder). 
    // Empty `service_schema` implies schema `public`
    string service_schema = 9;
    // Defines which database schema objects should be transferred, e.g. views,
    // functions, etc. 
    // All of the attributes in this block are optional and should be either
    // `BEFORE_DATA`, `AFTER_DATA` or `NEVER`
    PostgresObjectTransferSettings object_transfer_settings = 13;
    // List of security groups that the transfer associated with this endpoint should
    // use
    repeated string security_groups = 14;
}
// Settings specific to the PostgreSQL target endpoint
message PostgresTarget {
    reserved 6;
    // Database connection settings
    PostgresConnection connection = 1;
    // Target database name
    string database = 2;
    // User for database access. Required unless Connection Manager connection is used
    string user = 3;
    // Password for database access.
    Secret password = 4;
    // Cleanup policy for activate, reactivate and reupload processes. 
    // One of: DISABLED, DROP, TRUNCATE. Default is TRUNCATE
    CleanupPolicy cleanup_policy = 5;
    // List of security groups that the transfer associated with this endpoint should
    // use
    repeated string security_groups = 7;
    // Whether can change table schema if schema changed on source
    bool is_schema_migration_disabled = 8;
}
