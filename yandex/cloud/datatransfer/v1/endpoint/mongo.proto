syntax = "proto3";

package yandex.cloud.datatransfer.v1.endpoint;

option go_package = "github.com/yandex-cloud/go-genproto/yandex/cloud/datatransfer/v1/endpoint;endpoint";
option java_package = "yandex.cloud.api.datatransfer.v1.endpoint";
option csharp_namespace = "Yandex.Cloud.Datatransfer.V1.EndPoint"; // there is a clash with class Endpoint in namespace Yandex.Cloud.Datatransfer.V1

import "yandex/cloud/datatransfer/v1/endpoint/common.proto";

message OnPremiseMongo {
    reserved 3 to 4;
    // Host names of the replica set
    repeated string hosts = 1;
    // TCP Port number
    int64 port = 2;
    // Replica set name
    string replica_set = 5;
    // TLS settings for the server connection. Empty implies plaintext connection
    TLSMode tls_mode = 6;
}
message MongoConnectionOptions {
    oneof address {
        // Identifier of the Yandex StoreDoc cluster
        // Use one of:  mdb_cluster_id/on_premise/connection_manager_connection
        string mdb_cluster_id = 1;
        // Connection settings of the on-premise MongoDB server
        // Use one of:  mdb_cluster_id/on_premise/connection_manager_connection
        OnPremiseMongo on_premise = 2;
        // Get StoreDoc/MongoDB installation params and credentials from Connection Manager
        // Use one of:  mdb_cluster_id/on_premise/connection_manager_connection
        MongoConnectionManagerConnection connection_manager_connection = 6;
    }
    // User name, required unless connection_manager_connection is used
    string user = 3;
    // Password for user
    Secret password = 4;
    // Database name associated with the credentials
    string auth_source = 5;
}
message MongoConnection {
    reserved 1 to 2;
    oneof connection {
        MongoConnectionOptions connection_options = 3;
    }
}
message MongoCollection {
    string database_name = 1;
    string collection_name = 2;
}
// Settings specific to the MongoDB source endpoint
message MongoSource {
    reserved 3 to 5, 9 to 10;
    // Connection settings
    MongoConnection connection = 1;
    // Identifier of the Yandex Cloud VPC subnetwork to user for accessing the
    // database. 
    // If omitted, the server has to be accessible via Internet
    string subnet_id = 2;
    // List of collections for replication. Empty list implies replication of all
    // tables on the deployment. Allowed to use * as collection name.
    repeated MongoCollection collections = 6;
    // List of forbidden collections for replication. Allowed to use * as collection
    // name for forbid all collections of concrete schema.
    repeated MongoCollection excluded_collections = 7;
    // Read mode for mongo client: whether the secondary server should be preferred to
    // the primary when copying data
    bool secondary_preferred_mode = 8;
    // List of security groups that the transfer associated with this endpoint should
    // use
    repeated string security_groups = 11;
}
// Settings specific to the MongoDB target endpoint
message MongoTarget {
    reserved 3 to 5;
    // Connection settings
    MongoConnection connection = 1;
    // Database name. If not empty, then all the data will be written to the database
    // with the specified name; otherwise the database name is the same as in the
    // source endpoint
    string database = 2;
    // How to clean collections when activating the transfer. One of `DISABLED`, `DROP`
    // or `TRUNCATE`
    CleanupPolicy cleanup_policy = 6;
    // Identifier of the Yandex Cloud VPC subnetwork to user for accessing the
    // database. 
    // If omitted, the server has to be accessible via Internet
    string subnet_id = 7;
    // List of security groups that the transfer associated with this endpoint should
    // use
    repeated string security_groups = 8;
}
message MongoConnectionManagerConnection {
    // ID of connectionmanager connection with mongodb/Yandex Storedoc installation
    // parameters and credentials
    string connection_id = 1;
    // Replica set name, used only for on-premise mongodb installations
    string replica_set = 2;
}
