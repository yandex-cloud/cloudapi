syntax = "proto3";

package yandex.cloud.ai.assistants.v1.runs;

import "yandex/cloud/ai/common/common.proto";
import "yandex/cloud/ai/assistants/v1/common.proto";
import "yandex/cloud/ai/assistants/v1/threads/message.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/yandex-cloud/go-genproto/yandex/cloud/ai/assistants/v1/runs;runs";
option java_package = "yandex.cloud.api.ai.assistants.v1.runs";

// Represents a run of an assistant over a specific thread of messages.
message Run {
  // Unique identifier of the run.
  string id = 1;

  // Identifier for the assistant that is being run.
  string assistant_id = 2;

  // Identifier for the thread of messages that this run is associated with.
  string thread_id = 3;

  // Identifier of the subject who created this run.
  string created_by = 4;

  // Timestamp representing when the run was created.
  google.protobuf.Timestamp created_at = 5;

  // Set of key-value pairs that can be used to organize and categorize the run.
  map<string, string> labels = 6;

  // Current state of the run, including its status and any associated data.
  RunState state = 7;

  // Information about the content usage during the run, such as the number of [tokens](/docs/foundation-models/concepts/yandexgpt/tokens) used by the completion model.
  ContentUsage usage = 8;

  // Configuration options for truncating the prompt when the token count exceeds a specified limit.
  // If specified, these options will override the assistant's prompt truncation settings for this run.
  yandex.cloud.ai.assistants.v1.PromptTruncationOptions custom_prompt_truncation_options = 9;

  // Configuration options for completion generation.
  // If specified, these options will override the assistant's completion settings for this run.
  yandex.cloud.ai.assistants.v1.CompletionOptions custom_completion_options = 10;

  // List of tools that are available for the assistant to use in this run.
  repeated yandex.cloud.ai.assistants.v1.Tool tools = 11;
}

// Represents the current state of a run.
message RunState {
  // Enum representing the status of a run.
  enum RunStatus {
    // Default unspecified status.
    RUN_STATUS_UNSPECIFIED = 0;

    // Run has been created but has not started yet.
    PENDING = 1;

    // Run is currently in progress.
    IN_PROGRESS = 2;

    // Run has failed due to an error.
    FAILED = 3;

    // Run has completed successfully.
    COMPLETED = 4;

    // The run is waiting for tool calls to be executed and their results to be submitted.
    TOOL_CALLS = 5;
  }

  // Current status of a run.
  RunStatus status = 1;

  // Oneof field to capture additional data depending on the state of a run.
  oneof StateData {
    // Error information if a run has failed.
    yandex.cloud.ai.common.Error error = 2;

    // Final message generated by an assistant if a run has completed successfully.
    yandex.cloud.ai.assistants.v1.threads.Message completed_message = 3;

    // A list of tool calls requested by the assistant.
    yandex.cloud.ai.assistants.v1.ToolCallList tool_call_list = 4;
  }
}

// Represents the content usage during a run, such as the number of [tokens](/docs/foundation-models/concepts/yandexgpt/tokens) used by the completion model.
message ContentUsage {
  // The number of tokens used in the prompt.
  int64 prompt_tokens = 1;

  // The number of tokens used in the completion response.
  int64 completion_tokens = 2;

  // The total number of tokens used (prompt + completion).
  int64 total_tokens = 3;
}
