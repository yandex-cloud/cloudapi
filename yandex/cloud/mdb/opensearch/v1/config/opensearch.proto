syntax = "proto3";

package yandex.cloud.mdb.opensearch.v1.config;

import "google/protobuf/wrappers.proto";
import "yandex/cloud/validation.proto";

option go_package = "github.com/yandex-cloud/go-genproto/yandex/cloud/mdb/opensearch/v1/config;opensearch";
option java_package = "yandex.cloud.api.mdb.opensearch.v1";

// OpenSearch server configuration settings.
message OpenSearchConfig2 {
  // Defines the maximum product of fields and terms that are queryable simultaneously.
  // Before OpenSearch 2.16, a cluster restart was required in order to apply this static setting.
  // Now dynamic, existing search thread pools may use the old static value initially, causing **TooManyClauses** exceptions.
  // New thread pools use the updated value.
  //
  // Default value: **1024**.
  //
  // Change of the setting is applied with restart.
  //
  // For details, see [OpenSearch documentation](https://docs.opensearch.org/latest/install-and-configure/configuring-opensearch/index-settings/#dynamic-cluster-level-index-settings).
  google.protobuf.Int64Value max_clause_count = 3 [(value) = "1-2147483647", json_name = "max_clause_count"];

  // The maximum size of the field data cache.
  // May be specified as an absolute value (for example, 8GB) or a percentage of the node heap (for example, 50%).
  // This setting is dynamic. If you don't specify this setting, the maximum size is 35%.
  // This value should be smaller than the **indices.breaker.fielddata.limit**
  //
  // Change of the setting is applied with restart.
  //
  // For details, see [OpenSearch documentation](https://docs.opensearch.org/latest/install-and-configure/configuring-opensearch/index-settings/#dynamic-cluster-level-index-settings).
  string fielddata_cache_size = 4 [json_name = "fielddata_cache_size"];

  reserved 5;

  // Allowed remote hosts
  //
  // Change of the setting is applied with restart.
  //
  // For details, see [OpenSearch documentation](https://docs.opensearch.org/latest/api-reference/document-apis/reindex/#remote-cluster-allow-list).
  string reindex_remote_whitelist = 6 [json_name = "reindex_remote_whitelist"];
}

message OpenSearchConfigSet2 {
  // Effective configuration (a combination of user-defined configuration and default configuration).
  OpenSearchConfig2 effective_config = 1 [(required) = true];

  // User-defined configuration.
  OpenSearchConfig2 user_config = 2;

  // Default configuration.
  OpenSearchConfig2 default_config = 3;
}
