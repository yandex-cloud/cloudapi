syntax = "proto3";

package yandex.cloud.connectionmanager.v1;

import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";
import "yandex/cloud/connectionmanager/v1/mysql.proto";
import "yandex/cloud/connectionmanager/v1/postgresql.proto";
import "yandex/cloud/connectionmanager/v1/mongodb.proto";
import "yandex/cloud/connectionmanager/v1/clickhouse.proto";
import "yandex/cloud/connectionmanager/v1/redis.proto";
import "yandex/cloud/connectionmanager/v1/trino.proto";
import "yandex/cloud/connectionmanager/v1/valkey.proto";
import "yandex/cloud/connectionmanager/v1/opensearch.proto";
import "yandex/cloud/connectionmanager/v1/greenplum.proto";
import "yandex/cloud/connectionmanager/v1/kafka.proto";
import "yandex/cloud/connectionmanager/v1/storedoc.proto";


option go_package = "github.com/yandex-cloud/go-genproto/yandex/cloud/connectionmanager/v1;connectionmanager";
option java_package = "yandex.cloud.api.connectionmanager.v1";

// Connection parameters for various database and service types.
message ConnectionParams {
    // Database or service connection configuration.
    oneof type {
        // PostgreSQL database connection parameters.
        PostgreSQLConnection postgresql = 1;
        // MySQL database connection parameters.
        MySQLConnection mysql = 2;
        // MongoDB database connection parameters.
        MongoDBConnection mongodb = 3;
        // ClickHouse database connection parameters.
        ClickHouseConnection clickhouse = 4;
        // Apache Kafka message broker connection parameters.
        KafkaConnection kafka = 5;
        // Redis in-memory data store connection parameters.
        RedisConnection redis = 6;
        // OpenSearch search engine connection parameters.
        OpenSearchConnection opensearch = 7;
        // Trino distributed SQL query engine connection parameters.
        TrinoConnection trino = 8;
        // Valkey in-memory data store connection parameters.
        ValkeyConnection valkey = 9;
        // Greenplum data warehouse connection parameters.
        GreenplumConnection greenplum = 10;
        // StoreDoc document store connection parameters.
        StoreDocConnection storedoc = 11;
    }
}

// Reference to a Lockbox secret.
message LockboxSecret {
    // ID of the Lockbox secret.
    string id = 1;
    // Lockbox secret version.
    string version = 2;
    // The newest available version of the Lockbox secret.
    string newest_version = 3;
}

// Specification for creating a new Lockbox secret.
message LockboxSecretSpec {
    // ID of the folder where the Lockbox secret will be created. If omitted, the secret will be created in the connection's folder.
    string folder_id = 1;
}

// Database or service type enumeration.
enum DBType {
    // Unspecified database type.
    DB_TYPE_UNSPECIFIED = 0;
    // PostgreSQL database.
    POSTGRESQL = 1;
    // MySQL database.
    MYSQL = 2;
    // ClickHouse database.
    CLICKHOUSE = 3;
    // MongoDB database.
    MONGODB = 4;
    // Apache Kafka message broker.
    KAFKA = 5;
    // Redis in-memory data store.
    REDIS = 6;
    // OpenSearch search engine.
    OPENSEARCH = 7;
    // Trino distributed SQL query engine.
    TRINO = 8;
    // Valkey in-memory data store.
    VALKEY = 9;
    // Greenplum data warehouse.
    GREENPLUM = 10;
    // StoreDoc document store.
    STOREDOC = 11;
}

// A Connection resource represents a configured connection to a database or service.
message Connection {
    reserved 11;
    // ID of the connection. Generated at creation time.
    string id = 1;
    // ID of the folder that the connection belongs to.
    string folder_id = 2;
    // Creation timestamp.
    google.protobuf.Timestamp created_at = 3;
    // Last update timestamp.
    google.protobuf.Timestamp updated_at = 4;
    // Name of the connection.
    string name = 5;
    // Description of the connection.
    string description = 6;
    // Connection labels as `key:value` pairs.
    map<string, string> labels = 7;
    // ID of the subject which created the connection.
    string created_by = 8;
    // Connection parameters specific to the database or service type.
    ConnectionParams params = 9;

    // Secret configuration for authentication.
    oneof secret {
        // Reference to the Lockbox secret containing connection credentials.
        LockboxSecret lockbox_secret = 10;
    }
    // Secret specification for creating a new secret.
    oneof secret_spec {
        // Specification for creating a new Lockbox secret.
        LockboxSecretSpec lockbox_secret_spec = 14;
    }
    // Whether this connection is managed by the system (e.g. an MDB cluster).
    bool is_managed = 12;
    // Whether the current user can use this connection. Filled only when `with_can_use` has been requested in ListConnectionRequest.
    google.protobuf.BoolValue can_use = 13;
}
