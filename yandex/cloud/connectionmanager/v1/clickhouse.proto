syntax = "proto3";

package yandex.cloud.connectionmanager.v1;

import "yandex/cloud/connectionmanager/v1/common.proto";

option go_package = "github.com/yandex-cloud/go-genproto/yandex/cloud/connectionmanager/v1;connectionmanager";
option java_package = "yandex.cloud.api.connectionmanager.v1";

message ClickHouseAuth {
    oneof security {
        UserPasswordAuth user_password = 1;
    }
}
message ClickHouseCluster {
    reserved 1 to 3, 5;
    message Host {
        enum Health {
            HEALTH_UNKNOWN = 0;
            ALIVE = 1;
            DEAD = 2;
            DEGRADED = 3;
        }
        string host = 1;
        // depends on tls params may vary as http or https
        int64 http_port = 2;
        int64 tcp_port = 3;
        string shard_name = 4;
        Health health = 5;
    }
    message ShardGroup {
      string name = 1;
      repeated string shard_names = 2;
    }

    TLSParams tls_params = 4;
    repeated Host hosts = 6;
    repeated ShardGroup shard_groups = 7;
}

message ClickHouseConnection {
    // When creating/updating Connection, the field "cluster" is mutually
    // exclusive with "managed_cluster_id".
    ClickHouseCluster cluster = 1;
    // When creating/updating Connection, the field "managed_cluster_id" is
    // mutually exclusive with "cluster".
    string managed_cluster_id = 2;
    ClickHouseAuth auth = 3;

    repeated string databases = 4;
}
