syntax = "proto3";
package yandex.cloud.billing.usage_records.v1;
option go_package = "github.com/yandex-cloud/go-genproto/yandex/cloud/billing/usage_records/v1;usageRecords";
option java_package = "yandex.cloud.api.billing.usage_records.v1";

import "google/protobuf/timestamp.proto";

import "yandex/cloud/billing/usage_records/v1/billing_types.proto";

import "yandex/cloud/validation.proto";

// MetadataService service for retrieving metadata related to usage records
//
// The MetadataService provides a set of methods for retrieving metadata and reference information
// about billing usage records within a specific billing account and date range. This metadata
// includes information about clouds, services, SKUs, labels, and resources
// to understand the available entity structure before building detailed usage reports.
//
// Required permissions:
// All methods in this service require one of the following permissions on the specified billing account:
// - `billing.accounts.getReport`
service MetadataService {
    // GetUsage returns usage metadata including available clouds, services, SKUs, label keys, and date ranges
    // for a specific billing account and date range.
    //
    // This method provides a view of all available entities
    // that can be used for usage reporting within the specified date range
    // for the billing account and all its sub-accounts including:
    // - List of available clouds in provided data range
    // - Available label keys that can be used for filtering or grouping
    // - Available services
    // - Available SKUs
    // - Available billing accounts (user billing account and his sub-accounts)
    //
    // Implementation details:
    // - Empty cloud_id values are translated to a "Usage is out of scope of the Cloud" designation
    // - All data is filtered to only include items that had usage during the specified date range
    //
    // Error handling:
    // - Returns INVALID_ARGUMENT if the request parameters fail validation
    // - Returns UNAUTHENTICATED if the user is not authenticated or the billing account does not exist
    // - Returns PERMISSION_DENIED if the user lacks required permissions
    // - Returns INTERNAL for internal server errors
    //
    // Required permissions:
    // - `billing.accounts.getReport` on the specified billing account
    rpc GetUsage(GetUsageRequest) returns (GetUsageResponse);

    // GetLabel returns available label keys and values for a specific billing account
    // with pagination support.
    //
    // This method retrieves all available label values for a specified label key
    // within the given date range. It supports filtering by label value substring
    // and provides pagination for handling large result sets.
    //
    // The method can be used in several ways:
    // - With label_key only: Returns all values for that key with pagination
    // - With label_key and label_value: Returns array of matching labelValues with pagination
    // - With label_key and label_value_filter: Returns all values for that key with pagination
    //     and a separate array of labelValues from the labelValueFilters parameter
    // - With label_key, label_value and label_value_filter: returns only an array of matching labelValues
    //     with pagination and ignores labelValueFilters (i.e., labelValueFilters won't be returned)
    //
    // Implementation details:
    // - Case-insensitive label value matching when label_value is provided
    // - When label_value is specified, label_value_filter is ignored
    // - Label values are sorted alphabetically
    // - Pagination occurs when results exceed page_size
    //
    // Error handling:
    // - Returns INVALID_ARGUMENT if the request parameters fail validation
    // - Returns UNAUTHENTICATED if the user is not authenticated or the billing account does not exist
    // - Returns PERMISSION_DENIED if the user lacks required permissions
    // - Returns INTERNAL for internal server errors
    //
    // Required permissions:
    // - `billing.accounts.getReport` on the specified billing account
    rpc GetLabel(GetLabelRequest) returns (GetLabelResponse);

    // GetCloud returns available folders for specified clouds within a billing account
    // with optional filtering by cloud IDs, folder IDs and pagination support.
    //
    // This method returns a hierarchical view of clouds and their folders that the user
    // has access to within the specified date range. Results can be filtered by
    // specific cloud IDs and/or folder IDs, and pagination is supported for handling
    // large result sets.
    //
    // Implementation details:
    // - The method result does not contain empty cloud id information
    // - Filtering is done using case-insensitive substring matching
    // - Only clouds with at least one folder are included in the response
    // - Folder pagination is based on folder IDs, ordered alphabetically
    // - NextPageToken is only returned when there are more results available
    // - Base64-encoded page tokens are used for pagination state
    //
    // Error handling:
    // - Returns INVALID_ARGUMENT if the request parameters fail validation
    // - Returns UNAUTHENTICATED if the user is not authenticated or the billing account does not exist
    // - Returns PERMISSION_DENIED if the user lacks required permissions
    // - Returns INTERNAL for internal server errors
    //
    // Required permissions:
    // - `billing.accounts.getReport` on the specified billing account
    rpc GetCloud(GetCloudRequest) returns (GetCloudResponse);

    // GetResourceIDs returns all resource IDs for a specific billing account and date range
    // with pagination support.
    //
    // This method retrieves a list of all resource IDs that have usage records
    // within the specified date range and billing account. The results can be
    // filtered by a case-insensitive substring search on the resource ID.
    //
    // Implementation details:
    // - Filtering is done using case-insensitive substring matching
    // - Only resource IDs with actual usage in the period are returned
    //
    // Error handling:
    // - Returns INVALID_ARGUMENT if the request parameters fail validation
    // - Returns UNAUTHENTICATED if the user is not authenticated or the billing account does not exist
    // - Returns PERMISSION_DENIED if the user lacks required permissions
    // - Returns INTERNAL for internal server errors
    //
    // Required permissions:
    // - `billing.accounts.getReport` on the specified billing account
    //
    // Note: This RPC method is not yet implemented and will return UNIMPLEMENTED.
    rpc GetResourceIDs(GetResourceIDsRequest) returns (GetResourceIDsResponse);
}

// GetUsageRequest request for retrieving usage metadata
message GetUsageRequest {
    // Required. Billing account identifier.
    // The ID of the billing account to retrieve usage metadata for.
    // Must be a valid and accessible billing account ID.
    string billing_account_id = 1 [(required) = true];

    // Start date for data retrieval.
    // The inclusive start of the date range for which to retrieve usage metadata.
    // Must be specified and cannot be empty.
    // The time portion is ignored; the date is considered to start at 00:00:00.
    google.protobuf.Timestamp start_date = 2 [(required) = true];

    // End date for data retrieval.
    // The inclusive end of the date range for which to retrieve usage metadata.
    // Must be specified, cannot be empty, and must be greater than or equal to start_date.
    // The time portion is ignored; the date is considered to end at 23:59:59.
    google.protobuf.Timestamp end_date = 3 [(required) = true];
}

// Response for usage metadata request
message GetUsageResponse {
    // List of available clouds for the current user/context (billing_account_id with sub-accounts)
    // Contains cloud entities that the user has access to within the specified date range.
    //
    // Note: Empty cloud_id values are considered as "consumption outside the cloud"
    // and represented with an empty string id and name "Usage is out of scope of the Cloud"
    repeated Cloud clouds = 1;

    // List of available label keys for the current user/context (billing_account_id with sub-accounts)
    // Contains all label keys that exist in usage records
    // within the specified date range.
    // These keys can be used for filtering and grouping in reports or
    // passed to the GetLabel method to retrieve possible values.
    repeated string label_keys = 2;

    // List of available services for the current user/context (billing_account_id with sub-accounts)
    // Contains service entities with their IDs, names and descriptions that
    // have usage records within the specified billing account and date range.
    // Services represent the top-level grouping of cloud offerings.
    repeated Service services = 3;

    // List of available SKUs for the current user/context (billing_account_id with sub-accounts)
    // Contains SKU entities with their IDs, names, translations and pricing units
    // that have usage records within the specified billing account and date range.
    // SKUs represent specific service offerings
    repeated SKU skus = 4;

    // List of available BillingAccounts for the current user/context (billing_account_id with sub-accounts)
    // Contains billing account entities that the user has access to and
    // that have usage records within the specified date range.
    // Includes both the main account and any sub-accounts.
    repeated BillingAccount billing_accounts = 5;
}

// Request for retrieving label metadata
message GetLabelRequest {
    // Required. Billing account identifier.
    // The ID of the billing account to retrieve label metadata for.
    // Must be a valid and accessible billing account ID.
    string billing_account_id = 1 [(required) = true];

    // Start date for data retrieval.
    // The inclusive start of the date range for which to retrieve label metadata.
    // Must be specified and cannot be empty.
    // The time portion is ignored; the date is considered to start at 00:00:00.
    google.protobuf.Timestamp start_date = 2 [(required) = true];

    // End date for data retrieval.
    // The inclusive end of the date range for which to retrieve label metadata.
    // Must be specified, cannot be empty, and must be greater than or equal to start_date.
    // The time portion is ignored; the date is considered to end at 23:59:59.
    google.protobuf.Timestamp end_date = 3 [(required) = true];

    // Label key to filter values for. If specified, response will contain values
    // for this specific key.
    // Must be a non-empty string representing a valid label key.
    string label_key = 4 [(required) = true];

    // Optional. If provided along with label_key, the response will return
    // an array of matches for this label_value.
    // Used for exact matching of label values.
    // If specified, label_value_filter is ignored and pagination is not applied.
    string label_value = 5;

    // Optional array of label values to filter results:
    // Returns in response as is if label_value is not provided, otherwise returns empty label_value_filter
    repeated string label_value_filter = 6;

    // Optional. Page size for paginated results.
    // Specifies the maximum number of label values to return per page.
    // If not specified or set to 0, defaults to 10.
    // If greater than 10000, will be coerced down to 10000.
    int64 page_size = 7;

    // Optional. Page token for paginated results.
    // Token from a previous GetLabelResponse used to retrieve the next page.
    // If empty, retrieves the first page.
    string page_token = 8;
}

// Response for label metadata request
message GetLabelResponse {
    // List of label values matching the request criteria
    // Contains label values that match the specified label key pattern.
    // Values are sorted alphabetically.
    repeated string label_values = 1;

    // List of label values from the label_value_filter in the request
    // Contains the same values as provided in the request's label_value_filter.
    // Included for convenience in the response.
    // This field is only populated when label_value_filter was specified in the request
    // and label_value was not specified.
    repeated string label_value_filter = 2;

    // Token for getting the next page of results.
    // If empty, there are no more results.
    // Use this token in a subsequent request's page_token field to retrieve
    // the next page of results.
    // The token encodes the pagination state.
    //
    // It should be passed verbatim in subsequent requests.
    string next_page_token = 3;
}

// Request for retrieving folder metadata
message GetCloudRequest {
    // Required. Billing account identifier.
    // The ID of the billing account to retrieve cloud and folder metadata for.
    // Must be a valid and accessible billing account ID.
    string billing_account_id = 1 [(required) = true];

    // Start date for data retrieval.
    // The inclusive start of the date range for which to retrieve cloud and folder metadata.
    // Must be specified and cannot be empty.
    // The time portion is ignored; the date is considered to start at 00:00:00.
    google.protobuf.Timestamp start_date = 2 [(required) = true];

    // End date for data retrieval.
    // The inclusive end of the date range for which to retrieve cloud and folder metadata.
    // Must be specified, cannot be empty, and must be greater than or equal to start_date.
    // The time portion is ignored; the date is considered to end at 23:59:59.
    google.protobuf.Timestamp end_date = 3 [(required) = true];

    // Optional. List of cloud IDs to filter clouds by.
    // Note: cloud_id filtering supports case-insensitive substring matching.
    // No wildcards or regex patterns are supported - just simple substring matching.
    // The filter works with partial cloud IDs, and will match any cloud where
    // the provided substring appears anywhere in the cloud_id.
    // For example, filter "abc" will match cloud_ids like "abc123", "123abc", or "1abc2".
    // If empty, no filtering by cloud ID is applied.
    repeated string cloud_ids = 4;

    // Optional. List of folder IDs to filter folders by.
    // Note: folder_id filtering supports case-insensitive substring matching.
    // No wildcards or regex patterns are supported - just simple substring matching.
    // The filter works with partial folder IDs, and will match any folder where
    // the provided substring appears anywhere in the folder_id.
    // For example, filter "abc" will match folder_ids like "abc123", "123abc", or "1abc2".
    // If empty, no filtering by folder ID is applied.
    repeated string folder_ids = 5;

    // Optional. Page size for paginated results.
    // Specifies the maximum number of Folder objects to return per page.
    // If not specified or set to 0, defaults to 10.
    // If greater than 10000, will be coerced down to 10000.
    int64 page_size = 6;

    // Optional. Page token for paginated results.
    // Token from a previous GetCloudResponse used to retrieve the next page.
    // If empty, retrieves the first page.
    // The token encodes the pagination state.
    string page_token = 7;
}

// Response for cloud metadata request
message GetCloudResponse {
    // Information about a cloud and its folders
    message CloudInfo {
        // Cloud information
        Cloud cloud = 1;

        // List of folders belonging to this cloud
        // Contains folder entities that belong to this cloud
        // and match any folder ID filtering criteria from the request.
        // The list is sorted by folder ID in ascending order.
        //
        // Only folders that had usage during the specified date range are included.
        repeated Folder folders = 2;
    }

    // List of clouds matching the request criteria
    // Contains CloudInfo objects for each cloud that matches the specified
    // filtering criteria
    //
    // Note: only clouds with at least one folder are included in the response.
    repeated CloudInfo items = 1;

    // Token for getting the next page of results.
    // If empty, there are no more results.
    // Use this token in a subsequent request's page_token field to retrieve
    // the next page of results.
    // The token encodes the pagination state.
    //
    // It should be passed verbatim in subsequent requests.
    string next_page_token = 2;
}

// GetResourceIDsRequest request for retrieving resource IDs.
// This message defines the parameters needed to fetch and filter resource IDs
// associated with a billing account within a date range.
message GetResourceIDsRequest {
    // Required. Billing account identifier.
    // The ID of the billing account to retrieve resource IDs for.
    // Must be a valid and accessible billing account ID.
    string billing_account_id = 1 [(required) = true];

    // Start date for data retrieval.
    // The inclusive start of the date range for which to retrieve resource IDs.
    // Must be specified and cannot be empty.
    // The time portion is ignored; the date is considered to start at 00:00:00.
    google.protobuf.Timestamp start_date = 2 [(required) = true];

    // End date for data retrieval.
    // The inclusive end of the date range for which to retrieve resource IDs.
    // Must be specified, cannot be empty, and must be greater than or equal to start_date.
    // The time portion is ignored; the date is considered to end at 23:59:59.
    google.protobuf.Timestamp end_date = 3 [(required) = true];

    // Optional. Resource ID pattern for search filtering.
    // When provided, the response will include only resource IDs
    // that contain this string (case-insensitive substring match).
    // No wildcards or regex patterns are supported - just simple substring matching.
    string resource_id = 4;

    // Optional. Page size for paginated results.
    // Specifies the maximum number of resource IDs to return per page.
    // If not specified or set to 0, defaults to 10.
    // If greater than 10000, will be coerced down to 10000.
    int64 page_size = 5;

    // Optional. Page token for paginated results.
    // Token from a previous GetResourceIDsResponse used to retrieve the next page.
    // If empty, retrieves the first page.
    // The token encodes the pagination state.
    string page_token = 6;
}

// Response for resource IDs request.
// This message contains a list of resource IDs that match the search criteria
// specified in the request, along with pagination information.
message GetResourceIDsResponse {
    // List of resource IDs matching the request criteria.
    // These represent unique identifiers for resources within the billing account
    // that had usage during the specified date range.
    // If a resource_id filter was provided in the request, only IDs
    // containing that substring (case-insensitive) will be included.
    // Resource IDs are sorted alphabetically in ascending order.
    repeated string resource_ids = 1;

    // Token for getting the next page of results.
    // This token should be passed in the page_token field of subsequent requests.
    // If empty, there are no more results available.
    // The token encodes the pagination state.
    //
    // It should be passed verbatim in subsequent requests.
    string next_page_token = 2;
}
