syntax = "proto3";

package yandex.cloud.devtools.ycvc.v1;

import "yandex/cloud/validation.proto";

option go_package = "github.com/yandex-cloud/go-genproto/yandex/cloud/devtools/ycvc/v1;ycvc";
option java_multiple_files = true;
option java_outer_classname = "VersionControlServiceProto";
option java_package = "yandex.cloud.api.devtools.ycvc.v1";
import "google/api/annotations.proto";

// Version Control Service for managing tool version blacklists.
// This service manages obsolete (deprecated/blocked) versions only.
//
// API Behavior:
// - Supported versions: Return successful InitResponse.
// - Deprecated versions: Return successful InitResponse with deprecation_warning.
// - Blocked versions: Return FAILED_PRECONDITION error with descriptive message.
service VersionControlService {
  // Initializes client and checks if the provided version is obsolete.
  // Returns FAILED_PRECONDITION error for blocked versions.
  rpc Init(InitRequest) returns (InitResponse) {
    option (google.api.http) = {
      post: "/v1/obsolete_collections/{tool_name}:init"
      body: "*"
    };
  }
}

// Request to initialize and check version.
message InitRequest {
  // Tool name to check.
  string tool_name = 1 [(required) = true];

  // Version to check.
  string version = 2 [(required) = true];
}

// Response for initialization.
// Blocked versions return FAILED_PRECONDITION error instead.
message InitResponse {
  // Warning information for versions being phased out.
  DeprecationWarning deprecation_warning = 1;

  // Warning details for versions being phased out.
  message DeprecationWarning {
    // Reason why the version is being phased out.
    string reason = 1 [(required) = true];
  }
}
